name: Jerrycurl CI/CD
run-name: Build by @${{ github.actor}}
on:
  push:
    branches:
      - gh-actions
env:
  JERRY_SQLSERVER_CONN: SERVER=localhost;DATABASE=jerry_testdb;USER ID=sa;PASSWORD=YourStrong!Passw0rd;ENCRYPT=false
  JERRY_MYSQL_CONN: SERVER=localhost;DATABASE=jerry_testdb;
  JERRY_POSTGRES_CONN: SERVER=localhost;PORT=5432;DATABASE=jerry_testdb;Integrated Security=true;
jobs:
  build-project:
    runs-on: ${{ matrix.os }}

    strategy:
        matrix:
            os: [ubuntu-latest]
    steps:
      - name: Check out repo
        uses: actions/checkout@v3
        with:
          fetch-depth: 0
      - name: Set up SQL Server
        uses: ankane/setup-sqlserver@v1
        with:
          accept-eula: true
      - name: Set up MySQL
        uses: ankane/setup-mysql@v1
        with:
          database: jerry_testdb
      - name: Set up PostgreSQL
        uses: ankane/setup-postgres@v1
        with:
          database: jerry_testdb
      - name: Create databases
        run: |
          sqlcmd -U SA -P 'YourStrong!Passw0rd' -Q 'CREATE DATABASE jerry_testdb'
      - name: Build project
        shell: pwsh
        run: |
          .\build.ps1
      - name: Push packages
        run: |
          dotnet nuget add source --username thmskv --password ${{ secrets.GITHUB_TOKEN }} --store-password-in-clear-text --name github "https://nuget.pkg.github.com/thmskv/index.json"
          dotnet nuget push "artifacts/packages/*.nupkg" --api-key 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 --source "github"
          dotnet nuget push "artifacts/packages/*.snupkg" --api-key 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 --source "github"